package quick.virtualmachine;

import com.google.gson.Gson;
import java.util.ArrayList;
import java.util.List;
import java.util.StringTokenizer;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * @author mahe <mahe@maihaoche.com>
 * @date 6:50 下午
 */
public class CalculateBug {

    private static final String SEND_SMS = "【卖好车】共克时艰，“卖好车”联手“建行”为小微车商提供专项资金，年化4.95%，使用方便10秒到账，详询：4000390717";

    private static AtomicInteger sendSmsCount = new AtomicInteger(0);
    private static AtomicInteger phoneIndex = new AtomicInteger(0);
    private static final Gson gson = new Gson();
    /**
     *
     */
    public static void main(String[] args) {
        int i = 0;
        while (i++ < 20) {
            DTO dto = localSendSms(false, false);
            System.out.println(gson.toJson(dto));
        }

    }

    public static DTO localSendSms(Boolean test, Boolean reset) {
        if (reset) {
            sendSmsCount.set(0);
            phoneIndex.set(0);
        }
        // 发送一次就行了
        if (!test && sendSmsCount.get() > 0) {
            DTO result = DTO.ok();
            result.setMessage("phoneIndex: " + phoneIndex.get() + " , sendSmsCount: " + sendSmsCount.get());
            return result;
        }


        // 每次只发送50条
        StringTokenizer phonesSt = new StringTokenizer(phones, "\n");
        List<String> resultList = new ArrayList<>();

        int count = 0;
        int index = 0;
        if (test) {
            while(phonesSt.hasMoreTokens()) {
                DTO dto = new DTO();
                resultList.add(phonesSt.nextToken());
            }
        } else {
            while(phonesSt.hasMoreTokens() && count < 96) {
                if (index < phoneIndex.get()) {
                    index++;
                    phonesSt.nextToken();
                    continue;
                }
                DTO dto = new DTO();
                count++;
                index++;
                phoneIndex.incrementAndGet();
                resultList.add(phonesSt.nextToken());
            }
        }


        if (!test) {
            if (phoneIndex.get() + 1 >= phonesSt.countTokens()) {
                sendSmsCount.incrementAndGet();
            }
        }

        DTO result = DTO.ok(resultList);
        result.setMessage("phoneIndex: " + phoneIndex.get() + " , sendSmsCount: " + sendSmsCount.get());
        return result;
    }

    private static String phones = "13335965761\n"
            + "15163467749\n"
            + "18994888811\n"
            + "15057178817\n"
            + "18660664091\n"
            + "15885837653\n"
            + "18906644750\n"
            + "18596180777\n"
            + "13915015294\n"
            + "15912689993\n"
            + "17569136583\n"
            + "13975474503\n"
            + "15865763113\n"
            + "18267055496\n"
            + "13864087886\n"
            + "13887065850\n"
            + "15870738788\n"
            + "15996089307\n"
            + "15698024026\n"
            + "13809393690\n"
            + "18986738900\n"
            + "18366352558\n"
            + "13882843749\n"
            + "13829027075\n"
            + "18863917357\n"
            + "18919140121\n"
            + "18250587770\n"
            + "18663740678\n"
            + "13379600076\n"
            + "15200128108\n"
            + "18111529378\n"
            + "15969349870\n"
            + "13408841481\n"
            + "15771088881\n"
            + "18350753321\n"
            + "17051265136\n"
            + "18353123221\n"
            + "13903674666\n"
            + "18055661258\n"
            + "15352231881\n"
            + "15346318678\n"
            + "15050899990\n"
            + "18385871118\n"
            + "13055611239\n"
            + "15656881688\n"
            + "15517026003\n"
            + "18659884516\n"
            + "13979798517\n"
            + "15612044888\n"
            + "15605905255\n"
            + "17755611789\n"
            + "15253411555\n"
            + "18079742181\n"
            + "15960006586\n"
            + "18079403616\n"
            + "17068139888\n"
            + "15372275158\n"
            + "13960133505\n"
            + "13960021158\n"
            + "13055897127\n"
            + "13574791475\n"
            + "13838797829\n"
            + "18881811005\n"
            + "18919140983\n"
            + "13765640706\n"
            + "15218029388\n"
            + "15856540717\n"
            + "13181068068\n"
            + "18028130303\n"
            + "13773331233\n"
            + "13615660808\n"
            + "18206371447\n"
            + "18954915636\n"
            + "18039605574\n"
            + "15333890025\n"
            + "13697706252\n"
            + "15855551632\n"
            + "13676617028\n"
            + "15505367789\n"
            + "15555640707\n"
            + "13852013301\n"
            + "13607208806\n"
            + "18585758886\n"
            + "15592955554\n"
            + "18873626362\n"
            + "18136026566\n"
            + "18159660201\n"
            + "13706799409\n"
            + "17787045505\n"
            + "13212001724\n"
            + "13576628466\n"
            + "15207942376\n"
            + "17751060053\n"
            + "18060333010\n"
            + "18770119088\n"
            + "15505050055\n"
            + "18975659793\n"
            + "13371211906\n"
            + "13413776543\n"
            + "15381287185\n"
            + "15868323113\n"
            + "13699282132\n"
            + "13765084413\n"
            + "18656669692\n"
            + "13383361378\n"
            + "17779798585\n"
            + "13950444040\n"
            + "17806326699\n"
            + "13566136577\n"
            + "15051230451\n"
            + "15096588672\n"
            + "18783400783\n"
            + "15697888552\n"
            + "13805244961\n"
            + "15965747033\n"
            + "15860870586\n"
            + "13517970586\n"
            + "18305429726\n"
            + "13970697852\n"
            + "13987883021\n"
            + "17760853839\n"
            + "15163505677\n"
            + "13554908549\n"
            + "13177665656\n"
            + "18801177831\n"
            + "13366622009\n"
            + "18056705000\n"
            + "18937005557\n"
            + "15398756999\n"
            + "13810847877\n"
            + "18662888141\n"
            + "18890736292\n"
            + "15558867876\n"
            + "18679448555\n"
            + "15180405830\n"
            + "15357326688\n"
            + "13373367648\n"
            + "15193919392\n"
            + "18059616699\n"
            + "18953766081\n"
            + "13905988635\n"
            + "15972736717\n"
            + "13706880299\n"
            + "13999927773\n"
            + "15853119766\n"
            + "18663632958\n"
            + "13675969251\n"
            + "15027193867\n"
            + "18931552665\n"
            + "13850836663\n"
            + "18509223533\n"
            + "15517789477\n"
            + "13852628888\n"
            + "15750101197\n"
            + "13638833648\n"
            + "18180080444\n"
            + "18261099200\n"
            + "15563610969\n"
            + "15552229988\n"
            + "15326793540\n"
            + "13508895528\n"
            + "17733463812\n"
            + "18632016818\n"
            + "15091927783\n"
            + "18288885996\n"
            + "15180606594\n"
            + "15308139991\n"
            + "13553557373\n"
            + "15286788000\n"
            + "18859855535\n"
            + "18093601262\n"
            + "18654062116\n"
            + "13255957795\n"
            + "18596810858\n"
            + "18629088120\n"
            + "17777102803\n"
            + "18059676333\n"
            + "13278682182\n"
            + "15103048378\n"
            + "18685136388\n"
            + "13355375187\n"
            + "15571337777\n"
            + "13733555339\n"
            + "15357937077\n"
            + "13181696612\n"
            + "18949122087\n"
            + "17335727373\n"
            + "15888397998\n"
            + "18068639313\n"
            + "13519093289\n"
            + "13358821228\n"
            + "13763966598\n"
            + "18110705888\n"
            + "15232050618\n"
            + "13362995503\n"
            + "18639241767\n"
            + "13562785161\n"
            + "15053052761\n"
            + "15613011076\n"
            + "13870330439\n"
            + "13639213594\n"
            + "18986680977\n"
            + "15857000852\n"
            + "18263560070\n"
            + "18651007666\n"
            + "13572528185\n"
            + "13399670690\n"
            + "18659677653\n"
            + "18156876669\n"
            + "18279433807\n"
            + "18212655880\n"
            + "15954866122\n"
            + "18953934243\n"
            + "13638793024\n"
            + "13983971161\n"
            + "18366686667\n"
            + "18650969650\n"
            + "13355401811\n"
            + "17315665602\n"
            + "15263321407\n"
            + "15161256060\n"
            + "17786285551\n"
            + "18839372797\n"
            + "18206996436\n"
            + "13795668822\n"
            + "17361620638\n"
            + "15593663000\n"
            + "15985669770\n"
            + "13176551749\n"
            + "18685582444\n"
            + "13567733990\n"
            + "13636128068\n"
            + "15763099998\n"
            + "18270203301\n"
            + "13965630058\n"
            + "18979350008\n"
            + "15286873086\n"
            + "13408812815\n"
            + "18194313480\n"
            + "15870062555\n"
            + "18876885555\n"
            + "13529458908\n"
            + "18371120483\n"
            + "15870983069\n"
            + "13960027217\n"
            + "13673703983\n"
            + "13766784527\n"
            + "18976027636\n"
            + "18929363069\n"
            + "15870758245\n"
            + "17302353355\n"
            + "13960889879\n"
            + "18984083198\n"
            + "15016509119\n"
            + "18972624185\n"
            + "18285657176\n"
            + "13908146366\n"
            + "18711436399\n"
            + "15108206420\n"
            + "18888316061\n"
            + "13579827790\n"
            + "18508536817\n"
            + "13921691016\n"
            + "13459155999\n"
            + "15952268282\n"
            + "18959688887\n"
            + "18574412226\n"
            + "15160112276\n"
            + "18788639291\n"
            + "15720567555\n"
            + "18667112222\n"
            + "13328715555\n"
            + "13993690525\n"
            + "13638137377\n"
            + "13706401278\n"
            + "18264700623\n"
            + "17350322071\n"
            + "18659691057\n"
            + "18705662268\n"
            + "13708598787\n"
            + "15691122957\n"
            + "15287780068\n"
            + "13588184412\n"
            + "18660163404\n"
            + "13034976999\n"
            + "18206455683\n"
            + "13722947558\n"
            + "18829626602\n"
            + "13791956498\n"
            + "13203965655\n"
            + "13986774345\n"
            + "18683217804\n"
            + "13595590721\n"
            + "13699396086\n"
            + "18871618899\n"
            + "18184151170\n"
            + "18336565100\n"
            + "15254896567\n"
            + "15180231717\n"
            + "15085408029\n"
            + "18033945555\n"
            + "18551613288\n"
            + "18851806147\n"
            + "13346433586\n"
            + "13518095822\n"
            + "15871161358\n"
            + "15263225600\n"
            + "18264631601\n"
            + "13485888298\n"
            + "18260305332\n"
            + "13966410506\n"
            + "15887375299\n"
            + "18387878233\n"
            + "13666979133\n"
            + "18683505470\n"
            + "13370777683\n"
            + "18576305360\n"
            + "13016677666\n"
            + "13337213998\n"
            + "13736970828\n"
            + "13576682151\n"
            + "13605244105\n"
            + "15252117411\n"
            + "15335307191\n"
            + "13403868378\n"
            + "15993201179\n"
            + "15950810405\n"
            + "15350178000\n"
            + "18650611911\n"
            + "13194088099\n"
            + "13315505551\n"
            + "13960192456\n"
            + "13156698222\n"
            + "15835614480\n"
            + "18637750888\n"
            + "13055565550\n"
            + "18986585833\n"
            + "13960768963\n"
            + "15750180045\n"
            + "18384630468\n"
            + "18085579773\n"
            + "18051053888\n"
            + "18872367772\n"
            + "13666967528\n"
            + "13880602090\n"
            + "13881528237\n"
            + "13738222802\n"
            + "18187373774\n"
            + "13056078787\n"
            + "15974993318\n"
            + "15726883328\n"
            + "15105220052\n"
            + "13336334455\n"
            + "13979344066\n"
            + "13952122338\n"
            + "13607578748\n"
            + "13859731830\n"
            + "15224760913\n"
            + "15298533399\n"
            + "13030118487\n"
            + "15836137473\n"
            + "18791212595\n"
            + "13385452899\n"
            + "13965825666\n"
            + "15085266337\n"
            + "15391678111\n"
            + "13307949493\n"
            + "15833011115\n"
            + "18982072882\n"
            + "18807683335\n"
            + "13649458434\n"
            + "13801497651\n"
            + "15856768539\n"
            + "18639655567\n"
            + "15912683588\n"
            + "15812463780\n"
            + "18270006898\n"
            + "18672035561\n"
            + "15997265352\n"
            + "17615401674\n"
            + "15836603187\n"
            + "15960499571\n"
            + "18259132130\n"
            + "17734088719\n"
            + "15512969859\n"
            + "13663128696\n"
            + "18871818088\n"
            + "18053436218\n"
            + "13418564849\n"
            + "15933261630\n"
            + "18779468888\n"
            + "15052806088\n"
            + "13968141687\n"
            + "18084486888\n"
            + "18084522121\n"
            + "18279791252\n"
            + "18229200762\n"
            + "13311134239\n"
            + "13111661099\n"
            + "13177138666\n"
            + "15179442888\n"
            + "15956277238\n"
            + "13947909779\n"
            + "15185840416\n"
            + "13706006637\n"
            + "13655671167\n"
            + "15063524111\n"
            + "13912928432\n"
            + "18286629887\n"
            + "13562732456\n"
            + "18382878887\n"
            + "18251529183\n"
            + "13774537958\n"
            + "18789700977\n"
            + "13105994949\n"
            + "15392329999\n"
            + "13379999797\n"
            + "18065828786\n"
            + "18674183587\n"
            + "17787665555\n"
            + "17805421671\n"
            + "13706898983\n"
            + "13871809969\n"
            + "18870899211\n"
            + "18521532287\n"
            + "13765517815\n"
            + "13887124004\n"
            + "18179476899\n"
            + "13808762975\n"
            + "18690786360\n"
            + "18077880018\n"
            + "18271676278\n"
            + "13966611220\n"
            + "18972813519\n"
            + "13205821514\n"
            + "15850880186\n"
            + "18638330183\n"
            + "15895171158\n"
            + "18772329310\n"
            + "18650625767\n"
            + "18703935280\n"
            + "15103926565\n"
            + "15263587555\n"
            + "13767913708\n"
            + "13860086647\n"
            + "15870795120\n"
            + "15517720009\n"
            + "13981600729\n"
            + "18766138434\n"
            + "13831277540\n"
            + "18695295766\n"
            + "13970127768\n"
            + "18696311866\n"
            + "13879466837\n"
            + "18355052225\n"
            + "13595918229\n"
            + "15763223566\n"
            + "15251140009\n"
            + "15174406288\n"
            + "13093179029\n"
            + "18679477577\n"
            + "15059014808\n"
            + "13667069113\n"
            + "15855858766\n"
            + "13402885858\n"
            + "15252526966\n"
            + "18726169288\n"
            + "15295300803\n"
            + "13732921766\n"
            + "13587826288\n"
            + "13399668881\n"
            + "13722672666\n"
            + "15130024859\n"
            + "15647931880\n"
            + "15879901011\n"
            + "13855028887\n"
            + "15579711226\n"
            + "15328998278\n"
            + "18940843210\n"
            + "18955855959\n"
            + "13856893983\n"
            + "18086168877\n"
            + "15240894187\n"
            + "15265585879\n"
            + "15125072549\n"
            + "18952165556\n"
            + "13970700712\n"
            + "17753905598\n"
            + "15012102280\n"
            + "18364610306\n"
            + "13631107622\n"
            + "18991518080\n"
            + "13960640377\n"
            + "13769245388\n"
            + "18909487123\n"
            + "13585497657\n"
            + "18718097888\n"
            + "18222278981\n"
            + "13567700561\n"
            + "13527956703\n"
            + "17798774321\n"
            + "18936566867\n"
            + "13861922807\n"
            + "18755848111\n"
            + "13970128237\n"
            + "13986906605\n"
            + "15148640303\n"
            + "15327533311\n"
            + "13891174360\n"
            + "15180627763\n"
            + "18939393907\n"
            + "13656362297\n"
            + "18359395131\n"
            + "18054630919\n"
            + "13678389920\n"
            + "15105486365\n"
            + "13875772225\n"
            + "13817710528\n"
            + "13203908127\n"
            + "13806680398\n"
            + "15371245777\n"
            + "13688371229\n"
            + "18683071322\n"
            + "18931009124\n"
            + "13340973868\n"
            + "18086999218\n"
            + "13529289631\n"
            + "15121799871\n"
            + "18013707777\n"
            + "13594499948\n"
            + "18858809927\n"
            + "18957518777\n"
            + "17862230702\n"
            + "15925664999\n"
            + "18086317330\n"
            + "15293946258\n"
            + "13703472358\n"
            + "18806016988\n"
            + "13479427555\n"
            + "15607614333\n"
            + "15860855505\n"
            + "13775735185\n"
            + "13669771422\n"
            + "13619422426\n"
            + "15637525117\n"
            + "18816462007\n"
            + "13979495883\n"
            + "15350175070\n"
            + "13329762676\n"
            + "13055553557\n"
            + "13908801185\n"
            + "13887085633\n"
            + "15705665866\n"
            + "18074459888\n"
            + "18986371988\n"
            + "18679862278\n"
            + "13668121540\n"
            + "15233861555\n"
            + "15898887139\n"
            + "18187866678\n"
            + "18075879666\n"
            + "13947617155\n"
            + "15665567666\n"
            + "13309617123\n"
            + "13911941053\n"
            + "15979658199\n"
            + "13326970943\n"
            + "13409859199\n"
            + "18351018508\n"
            + "15332637077\n"
            + "13153813945\n"
            + "13225569899\n"
            + "15954368588\n"
            + "13955655655\n"
            + "18763381128\n"
            + "15724841535\n"
            + "18016758083\n"
            + "15115450523\n"
            + "13782646563\n"
            + "13930691171\n"
            + "15679756868\n"
            + "13721284628\n"
            + "13866824765\n"
            + "18695809070\n"
            + "18725920727\n"
            + "18662889658\n"
            + "15200557452\n"
            + "15001085345\n"
            + "15565975237\n"
            + "13755521561\n"
            + "13506029307\n"
            + "13666997266\n"
            + "18967296880\n"
            + "13093247777\n"
            + "15159697770\n"
            + "18979421088\n"
            + "15329068223\n"
            + "15726074999\n"
            + "15020948988\n"
            + "13887205686\n"
            + "15855638959\n"
            + "13906969569\n"
            + "13361128019\n"
            + "13955786189\n"
            + "18070180000\n"
            + "18232975344\n"
            + "15118050357\n"
            + "15830626777\n"
            + "13805665321\n"
            + "13780846783\n"
            + "15260112088\n"
            + "18551059517\n"
            + "15159188260\n"
            + "13540133250\n"
            + "17355642272\n"
            + "18107815250\n"
            + "13697274886\n"
            + "18872705050\n"
            + "18252603973\n"
            + "18654305680\n"
            + "13205660078\n"
            + "18765874896\n"
            + "18678807088\n"
            + "13770808335\n"
            + "15335401132\n"
            + "15275238582\n"
            + "13201888733\n"
            + "15064952487\n"
            + "18673608510\n"
            + "18056221333\n"
            + "13313877573\n"
            + "18388785090\n"
            + "13805319751\n"
            + "13635872062\n"
            + "18981166656\n"
            + "13677141198\n"
            + "18969067999\n"
            + "17773470226\n"
            + "13987841431\n"
            + "13603726875\n"
            + "18956605858\n"
            + "17707607760\n"
            + "13956820028\n"
            + "18728313188\n"
            + "13950963372\n"
            + "18074402188\n"
            + "13297227120\n"
            + "15993464250\n"
            + "13957370858\n"
            + "17373158563\n"
            + "13611103590\n"
            + "18873656897\n"
            + "18389395859\n"
            + "15184443444\n"
            + "13687114636\n"
            + "17853326283\n"
            + "13980283668\n"
            + "15236998553\n"
            + "15295334111\n"
            + "15996059592\n"
            + "13867944047\n"
            + "18650540333\n"
            + "18370619906\n"
            + "18700556898\n"
            + "15091988977\n"
            + "13985850215\n"
            + "18779423833\n"
            + "18751798311\n"
            + "18767974915\n"
            + "18133025988\n"
            + "18672221387\n"
            + "13388786138\n"
            + "13856614879\n"
            + "18678350818\n"
            + "15555821753\n"
            + "13855619174\n"
            + "18175860111\n"
            + "13915058294\n"
            + "18659980650\n"
            + "15753429722\n"
            + "17698301007\n"
            + "18687180345\n"
            + "18047177790\n"
            + "13395275444\n"
            + "18790951167\n"
            + "15965250285\n"
            + "15688577333\n"
            + "18871095599\n"
            + "13839282189\n"
            + "18170758167\n"
            + "15065037732\n"
            + "18786657389\n"
            + "15371599989\n"
            + "15616718863\n"
            + "18965037339\n"
            + "13585169845\n"
            + "13919471006\n"
            + "18655881722\n"
            + "13587272832\n"
            + "13860162888\n"
            + "13799896070\n"
            + "18765651847\n"
            + "15272700329\n"
            + "18872754830\n"
            + "18931566579\n"
            + "18768982121\n"
            + "15318399908\n"
            + "13325005763\n"
            + "13980682024\n"
            + "13298181666\n"
            + "13886661131\n"
            + "15912934167\n"
            + "13865108082\n"
            + "15067079516\n"
            + "15586365989\n"
            + "15315348787\n"
            + "13872490815\n"
            + "15125865672\n"
            + "15240368111\n"
            + "13338238816\n"
            + "13489627207\n"
            + "17719836888\n"
            + "13476629111\n"
            + "15850911000\n"
            + "13731811100\n"
            + "15070742346\n"
            + "18204770222\n"
            + "15319145365\n"
            + "18984886879\n"
            + "17793601793\n"
            + "13869464675\n"
            + "18715661499\n"
            + "15997146057\n"
            + "13084409822\n"
            + "18938604810\n"
            + "15345110782\n"
            + "13888265806\n"
            + "13738905821\n"
            + "18957257779\n"
            + "17785233331\n"
            + "18768238677\n"
            + "15807226556\n"
            + "18000383900\n"
            + "13339632888\n"
            + "15589209266\n"
            + "18648559555\n"
            + "15952526267\n"
            + "18931561706\n"
            + "18001287791\n"
            + "15594090777\n"
            + "18305722000\n"
            + "15345031555\n"
            + "15173636667\n"
            + "18223940888\n"
            + "15539312346\n"
            + "17139558098\n"
            + "18317671119\n"
            + "18253694283\n"
            + "13953874257\n"
            + "13967404012\n"
            + "15951483111\n"
            + "13320105555\n"
            + "15255665359\n"
            + "13062110668\n"
            + "15093786917\n"
            + "18827261062\n"
            + "18503961799\n"
            + "15069625789\n"
            + "18986362957\n"
            + "13513832425\n"
            + "15587426919\n"
            + "13904792538\n"
            + "13607973532\n"
            + "15393666099\n"
            + "18009792191\n"
            + "13670706432\n"
            + "13966999529\n"
            + "18855680844\n"
            + "13858802212\n"
            + "18854175123\n"
            + "15188234157\n"
            + "13608857708\n"
            + "18899503153\n"
            + "13155250010\n"
            + "17778755558\n"
            + "13865133066\n"
            + "15273418433\n"
            + "15023300505\n"
            + "18157767779\n"
            + "18931115222\n"
            + "13054636898\n"
            + "15952855223\n"
            + "18325881116\n"
            + "13292176318\n"
            + "18254280319\n"
            + "18959366826\n"
            + "15159663622\n"
            + "13123306000";
}

class DTO {
    String message;
    List<String> data;

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public List<String> getData() {
        return data;
    }

    public void setData(List<String> data) {
        this.data = data;
    }

    static DTO ok() {
        DTO dto = new DTO();
        dto.message = "";
        dto.data = new ArrayList<>();
        return dto;
    }

    static DTO ok(List<String> list) {
        DTO dto = new DTO();
        dto.message = "";
        dto.data = list;
        return dto;
    }
}